<tr class="line-item-row">
  <td>
    <div class="row">
        <div class="col-sm-3">
          <%= image_tag line_item.product.image, class:'img-responsive', width: 50 %>
        </div>
        <div class="col-sm-9">
          <h3><%= line_item.product.title %></h3>
          <% if checkout %>
            <%= line_item.quantity %> &times; <%= number_to_currency(line_item.product.price) %> | <strong><%= number_to_currency(line_item.total_price) %></strong>
          <% end %>
        </div>
        <div class="col-sm-12" style="margin-top: 1.5rem;" id="<%= line_item.product.id %>">
          <input type="hidden" class="product_id" value="<%= line_item.product_id %>">
          <% if checkout.blank? %>
            <input type="text" value="<%= line_item.quantity %>" class="quantity" style="width: 5rem;"> &times; <%= number_to_currency(line_item.product.price) %> | <strong><%= number_to_currency(line_item.total_price) %></strong>
          <% end %>
          <div class="pull-right">
            <% if checkout.blank? %>
              <button type="button" name="<%= line_item.product.id %>" class="btn btn-primary btn-sm btn-refresh update_quantity">  <span class='glyphicon glyphicon-refresh'></span></button>
              <%= link_to "<span class='glyphicon glyphicon-trash'></span>".html_safe , line_item, method: :delete, remote: true, class: "btn btn-default btn-sm btn-trash", data: { confirm: "Cancellare questo prodotto?" } %>
            <% end %>
          </div>

        </div>

    </div>
  </td>
</tr>


<script type="text/javascript">
  $(document).ready(function(){
    $('.update_quantity').click(function(){
      var id = $(this).prop('name');
      var product_id = $('#'+id+' > .product_id').val();
      var quantity = $('#'+id+' > .quantity').val();

      $.ajax({
        url: '/line_items/'+$(this).siblings('.product_id').val(),
        method: 'patch',
        data: {
          "product_id": product_id,
          "quantity": quantity
        }
      });

    });
  });
</script>
